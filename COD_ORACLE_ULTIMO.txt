CREATE TABLE CLIENTE(
DNI_CLI NUMBER(8),
NOM_CLI VARCHAR2(30),
APE_CLI VARCHAR2(30),
TEL_CLI NUMBER(11)
);

ALTER TABLE CLIENTE ADD CONSTRAINT PK_CLIENTE PRIMARY KEY (DNI_CLI);

SELECT * FROM CLIENTE;

CREATE TABLE PEDIDO(
COD_PED VARCHAR2(20),
NOM_PED VARCHAR2(30),
CAN_PED NUMBER(9),
CAT_PED VARCHAR2(20),
TIP_PED VARCHAR2(20),
FEC_PED DATE,
PRE_PED NUMBER(9,2),
EST_PED VARCHAR(20),
DNI_CLI NUMBER(8)
);

ALTER TABLE PEDIDO MODIFY EST_PED DEFAULT 'HABILITADO';
ALTER TABLE PEDIDO ADD CONSTRAINT CHK_PEDIDO CHECK(CAN_PED>0);
ALTER TABLE PEDIDO ADD CONSTRAINT CHK_PEDIDO2  CHECK(PRE_PED>0);
ALTER TABLE PEDIDO ADD CONSTRAINT PK_PEDIDO PRIMARY KEY(COD_PED);
ALTER TABLE PEDIDO ADD CONSTRAINT FK_PEDIDO FOREIGN KEY(DNI_CLI) REFERENCES CLIENTE(DNI_CLI);

SELECT * FROM PEDIDO;

CREATE TABLE CATALOGO(
COD_CAT VARCHAR2(20),
NOM_CAT VARCHAR2(30),
DES_CAT VARCHAR2(30)
);
ALTER TABLE CATALOGO ADD CONSTRAINT PK_CATALOGO PRIMARY KEY(COD_CAT);

SELECT * FROM CATALOGO;

CREATE TABLE PEDIDO_CATALOGO(
COD_PED VARCHAR2(20),
COD_CAT VARCHAR2(20)
);
ALTER TABLE PEDIDO_CATALOGO ADD CONSTRAINT FK_PEDIDO_CATALOGO1 FOREIGN KEY (COD_PED) REFERENCES PEDIDO(COD_PED);
ALTER TABLE PEDIDO_CATALOGO ADD CONSTRAINT FK_PEDIDO_CATALOGO2 FOREIGN KEY (COD_CAT) REFERENCES CATALOGO(COD_CAT);


SELECT * FROM PEDIDO_CATALOGO;

CREATE TABLE ALMACEN(
COD_ALM VARCHAR2(20),
DES_ALM VARCHAR2(30)
);

ALTER TABLE ALMACEN ADD CONSTRAINT PK_ALMACEN PRIMARY KEY(COD_ALM);

CREATE TABLE ALMACEN_CATALOGO(
COD_ALM VARCHAR2(20),
COD_CAT VARCHAR2(20),
STOCK NUMBER(9)
);

ALTER TABLE ALMACEN_CATALOGO ADD CONSTRAINT PK_ALMACEN_CATALOGO PRIMARY KEY(COD_CAT);
ALTER TABLE ALMACEN_CATALOGO ADD CONSTRAINT FK_ALMACEN_CATALOGO1 FOREIGN KEY(COD_ALM) REFERENCES ALMACEN(COD_ALM);
ALTER TABLE ALMACEN_CATALOGO ADD CONSTRAINT FK_ALMACEN_CATALOGO2 FOREIGN KEY(COD_CAT) REFERENCES CATALOGO(COD_CAT);
ALTER TABLE ALMACEN_CATALOGO ADD CONSTRAINT CHK_ALMACEN_CATALOGO CHECK(STOCK>0);

create table usuario(
nom_usu varchar2(100),
ape_usu varchar2(100),
sex_usu varchar2(2),
eda_usu number(8),
cor_usu varchar2(100),
tel_usu number(10),
cel_usu number(10),
dni_usu number(10),
usu_usu varchar2(40),
con_usu varchar2(40),
est_usu varchat2(80)
);

ALTER TABLE usuario MODIFY EST_usu DEFAULT 'HABILITADO';
alter table usuario add constraint pk_usuario primary key(dni_usu);
alter table usuario add constraint chk_usuario check(eda_usu>0);
----



  CREATE TABLE "MOANSOEMPRESA"."CONTROLSTOCK" 
   (	"TABLA" VARCHAR2(100 BYTE) DEFAULT 'ALMACEN CATALOGO', 
	"FECHA" DATE, 
	"DESCRIPCION" VARCHAR2(100 BYTE), 
	"MATERIAL" VARCHAR2(100 BYTE), 
	"CANTIDAD" NUMBER(30,0)
   ) 


----


  CREATE TABLE "MOANSOEMPRESA"."CONTROLCATALOGO" 
   (	"TABLA" VARCHAR2(100 BYTE) DEFAULT 'CATALOGO', 
	"FECHA" DATE, 
	"DESCRIPCION" VARCHAR2(100 BYTE), 
	"MATERIAL" VARCHAR2(100 BYTE)
   )


-------------------------------------

  CREATE OR REPLACE TRIGGER "MOANSOEMPRESA"."TRIGGER_STOCK" before insert or update or delete on almaceN_catalogo
for each row
begin
if inserting then 
insert into controlStock values(DEFAULT,sysdate,'SE AGREGO ',:new.cod_cat,:new.stock);
elsif updating then
insert into controlStock values(DEFAULT,sysdate,'SE AGREGO',:old.cod_cat,:new.Stock);
elsif deleting then
insert into controlStock values(DEFAULT,sysdate,'SE ELIMINO',:old.cod_cat,null);
end if;
end;
/
ALTER TRIGGER "MOANSOEMPRESA"."TRIGGER_STOCK" ENABLE;
--------------------------------------------------------
--  DDL for Trigger TRIGGER_CATALOGO
--------------------------------------------------------

  CREATE OR REPLACE TRIGGER "MOANSOEMPRESA"."TRIGGER_CATALOGO" before insert or update or delete on catalogo
for each row
begin
if inserting then 
insert into controlCatalogo values(DEFAULT,sysdate,'SE INSERTO ',:new.nom_cat);
elsif updating then
insert into controlCatalogo values(DEFAULT,sysdate,'SE ACTUALIZO',:old.nom_cat);
elsif deleting then
insert into controlCatalogo values(DEFAULT,sysdate,'SE ELIMINO',:old.nom_cat);
end if;
end;
/
ALTER TRIGGER "MOANSOEMPRESA"."TRIGGER_CATALOGO" ENABLE;